<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lampa Plugins</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --accent-indigo: #6366f1;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
      --accent-pink: #ec4899;
      --accent-orange: #f97316;
      --accent-cyan: #06b6d4;
      --accent-lime: #84cc16;
      --panel-bg: rgba(255, 255, 255, 0.82);
      --panel-border: rgba(255, 255, 255, 0.38);
      --text-primary: #0f172a;
      --text-secondary: #4b5563;
      --text-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      padding: clamp(1.4rem, 3.6vw, 2.3rem) clamp(1.1rem, 4.4vw, 1.9rem);
      background: linear-gradient(120deg, rgba(99, 102, 241, 0.35), rgba(14, 165, 233, 0.23), rgba(236, 72, 153, 0.3));
      background-size: 200% 200%;
      animation: background-pan 28s ease-in-out infinite;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -35%;
      background: radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.18), transparent 55%),
        radial-gradient(circle at 80% 30%, rgba(236, 72, 153, 0.18), transparent 60%),
        radial-gradient(circle at 50% 80%, rgba(132, 204, 22, 0.12), transparent 55%);
      filter: blur(60px);
      opacity: 0.9;
      pointer-events: none;
      animation: glow-shift 36s linear infinite;
    }

    main {
      width: min(820px, 100%);
      background: var(--panel-bg);
      backdrop-filter: blur(28px) saturate(145%);
      border-radius: clamp(22px, 4vw, 28px);
      border: 1px solid var(--panel-border);
      box-shadow: 0 24px 65px -32px rgba(15, 23, 42, 0.5);
      padding: clamp(1.6rem, 3.2vw, 2.4rem);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: visible;
    }

    main::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.16), rgba(14, 165, 233, 0.12));
      pointer-events: none;
      opacity: 0.6;
    }

    .header-block {
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.1rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.82rem;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(120deg, var(--accent-indigo), var(--accent-blue));
      padding: 0.38rem 0.95rem;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      box-shadow: 0 8px 16px -10px rgba(79, 70, 229, 0.65);
    }

    .headline {
      font-size: clamp(1.9rem, 4vw, 2.7rem);
      font-weight: 700;
      letter-spacing: -0.012em;
      margin: 0;
      color: rgba(15, 23, 42, 0.94);
      max-width: 26ch;
    }

    .description-container {
      position: relative;
      background: linear-gradient(135deg, rgba(236, 242, 255, 0.92), rgba(240, 245, 255, 0.9));
      border: 1px solid rgba(99, 102, 241, 0.16);
      border-radius: 20px;
      padding: clamp(1.15rem, 2.3vw, 1.65rem);
      box-shadow: 0 18px 45px -36px rgba(79, 70, 229, 0.48);
      display: grid;
      gap: 0.85rem;
      color: rgba(15, 23, 42, 0.88);
      overflow: hidden;
      max-width: 100%;
    }

    .description-container::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 5% 0%, rgba(99, 102, 241, 0.25), transparent 55%),
        radial-gradient(circle at 95% 10%, rgba(14, 165, 233, 0.22), transparent 50%),
        radial-gradient(circle at 50% 100%, rgba(236, 72, 153, 0.16), transparent 65%);
      opacity: 0.7;
      pointer-events: none;
    }

    .description-container>* {
      position: relative;
      z-index: 1;
    }

    .description-container p {
      margin: 0;
      font-size: 1rem;
      line-height: 1.58;
      max-width: 70ch;
    }

    .tab-container {
      width: 100%;
      margin-top: 1.1rem;
      display: flex;
      justify-content: center;
    }

    .tab-nav {
      display: inline-flex;
      gap: 0.5rem;
      padding: 0.35rem;
      border-radius: 999px;
      border: 1px solid rgba(99, 102, 241, 0.18);
      background: rgba(255, 255, 255, 0.55);
      backdrop-filter: blur(14px) saturate(140%);
      box-shadow: 0 16px 36px -26px rgba(15, 23, 42, 0.5);
      overflow-x: auto;
      max-width: 100%;
    }

    .tab-button {
      border: none;
      background: transparent;
      color: rgba(15, 23, 42, 0.68);
      font-weight: 600;
      font-size: 0.9rem;
      padding: 0.45rem 1rem;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.25s ease, color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease;
      position: relative;
      white-space: nowrap;
    }

    .tab-button:hover:not(.active),
    .tab-button:focus-visible:not(.active) {
      background: rgba(99, 102, 241, 0.12);
      color: rgba(79, 70, 229, 0.9);
      outline: none;
      transform: translateY(-1px);
    }

    .tab-button.active {
      background: linear-gradient(135deg, var(--accent-indigo), var(--accent-blue));
      color: #f8fafc;
      box-shadow: 0 16px 28px -22px rgba(79, 70, 229, 0.6);
    }

    .tab-button:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.35);
    }

    .description-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .description-tags li {
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(79, 70, 229, 0.9);
      background: rgba(79, 70, 229, 0.12);
      border: 1px solid rgba(79, 70, 229, 0.18);
      border-radius: 999px;
      padding: 0.35rem 0.85rem;
      font-weight: 600;
      backdrop-filter: blur(6px);
    }

    .plugins-grid {
      display: flex;
      flex-direction: column;
      gap: clamp(0.75rem, 1.5vw, 1.1rem);
      overflow: visible;
      padding-right: 0;
      flex: 1 1 auto;
      margin-top: clamp(0.75rem, 1.6vw, 1.2rem);
    }

    .plugins-grid::-webkit-scrollbar {
      width: 6px;
    }

    .plugin-card {
      --accent-start: var(--accent-indigo);
      --accent-end: var(--accent-blue);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: 0.95rem 1.05rem;
      background: rgba(248, 250, 252, 0.92);
      border-radius: 18px;
      border: 1px solid rgba(99, 102, 241, 0.14);
      text-decoration: none;
      color: inherit;
      transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(14px) saturate(140%);
      box-shadow: 0 16px 38px -28px rgba(15, 23, 42, 0.55);
      gap: 0.85rem;
      height: 100%;
    }

    .plugin-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .plugin-card::after {
      background: linear-gradient(150deg, rgba(255, 255, 255, 0.3), transparent 70%);
    }

    .plugin-meta {
      font-size: 0.86rem;
      color: var(--text-muted);
      letter-spacing: -0.002em;
      line-height: 1.45;
    }

    .plugin-card strong {
      font-size: 0.98rem;
      letter-spacing: -0.006em;
      font-weight: 650;
      position: relative;
      z-index: 1;
    }

    .plugin-card-content {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      position: relative;
      z-index: 1;
      flex: 1 1 auto;
    }

    .plugin-actions {
      display: inline-flex;
      gap: 0.45rem;
      align-items: center;
      position: relative;
      z-index: 1;
      margin-left: auto;
    }

    .plugin-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 0.4rem 0.85rem;
      font-size: 0.88rem;
      font-weight: 600;
      color: var(--accent-start);
      background: rgba(99, 102, 241, 0.12);
      border: 1px solid rgba(99, 102, 241, 0.16);
      transition: transform 0.25s ease, background 0.25s ease, color 0.25s ease, box-shadow 0.25s ease;
      text-decoration: none;
      min-width: 2.6rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .plugin-button.primary {
      color: #e2e8f0;
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      border-color: transparent;
      box-shadow: 0 12px 20px -16px rgba(59, 130, 246, 0.58);
    }

    .plugin-button .icon {
      font-size: 1rem;
    }

    .plugin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px -18px rgba(59, 130, 246, 0.55);
    }

    .plugin-button.secondary {
      background: rgba(15, 23, 42, 0.05);
      color: rgba(15, 23, 42, 0.75);
      border-color: rgba(15, 23, 42, 0.08);
    }

    .plugin-button.secondary:hover {
      background: rgba(15, 23, 42, 0.08);
      color: rgba(15, 23, 42, 0.9);
    }

    .plugin-button.copy {
      padding-inline: 1rem;
      gap: 0.4rem;
      color: rgba(15, 23, 42, 0.78);
      background: rgba(15, 23, 42, 0.04);
      border-color: rgba(15, 23, 42, 0.08);
      transition: transform 0.25s ease, background 0.25s ease, color 0.25s ease, box-shadow 0.25s ease, opacity 0.25s ease;
    }

    .plugin-button.copy:hover {
      background: rgba(15, 23, 42, 0.08);
      color: rgba(15, 23, 42, 0.92);
    }

    .plugin-button.copy:disabled {
      cursor: default;
      opacity: 0.72;
      pointer-events: none;
    }

    .plugin-button.copy::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.28), rgba(14, 165, 233, 0.28));
      opacity: 0;
      transform: scale(0.85);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 0;
    }

    .plugin-button.copy::after {
      content: attr(data-feedback);
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.82rem;
      font-weight: 650;
      letter-spacing: 0.01em;
      color: #f8fafc;
      opacity: 0;
      transform: translateY(45%);
      transition: opacity 0.28s ease, transform 0.28s ease;
      z-index: 2;
      pointer-events: none;
    }

    .plugin-button.copy .copy-icon,
    .plugin-button.copy .copy-label {
      position: relative;
      z-index: 3;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .plugin-button.copy .copy-icon {
      font-size: 1rem;
    }

    .plugin-button.copy.copied {
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      color: #f8fafc;
      border-color: transparent;
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 16px 34px -22px rgba(79, 70, 229, 0.65);
      animation: copy-pulse 0.9s ease;
    }

    .plugin-button.copy.copied::before {
      opacity: 0.9;
      transform: scale(1);
    }

    .plugin-button.copy.copied::after {
      opacity: 1;
      transform: translateY(0);
    }

    .plugin-button.copy.copied .copy-icon,
    .plugin-button.copy.copied .copy-label {
      opacity: 0;
      transform: translateY(-12px);
    }

    @keyframes copy-pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.45);
      }

      70% {
        box-shadow: 0 0 0 14px rgba(99, 102, 241, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
      }
    }

    .plugin-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 22px 45px -28px rgba(30, 64, 175, 0.5);
      border-color: rgba(99, 102, 241, 0.3);
    }

    .plugin-card:hover::after {
      opacity: 0.9;
    }

    footer {
      margin-top: 1.4rem;
      font-size: 0.9rem;
      color: #64748b;
      flex-shrink: 0;
      font-weight: 600;
    }

    footer a {
      color: inherit;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .plugin-card[aria-disabled="true"] {
      cursor: default;
      opacity: 0.85;
    }

    .plugins-grid[data-state="loading"] .plugin-card {
      animation: pulse 1.6s ease-in-out infinite;
      pointer-events: none;
    }

    .plugin-card:nth-of-type(6n + 1) {
      --accent-start: var(--accent-indigo);
      --accent-end: var(--accent-purple);
    }

    .plugin-card:nth-of-type(6n + 2) {
      --accent-start: var(--accent-blue);
      --accent-end: var(--accent-cyan);
    }

    .plugin-card:nth-of-type(6n + 3) {
      --accent-start: var(--accent-pink);
      --accent-end: var(--accent-purple);
    }

    .plugin-card:nth-of-type(6n + 4) {
      --accent-start: var(--accent-orange);
      --accent-end: var(--accent-pink);
    }

    .plugin-card:nth-of-type(6n + 5) {
      --accent-start: var(--accent-cyan);
      --accent-end: var(--accent-indigo);
    }

    .plugin-card:nth-of-type(6n) {
      --accent-start: var(--accent-lime);
      --accent-end: var(--accent-blue);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    @media (max-width: 640px) {
      body {
        display: block;
        min-height: 100vh;
        padding: 1.2rem 1rem 1.8rem;
      }

      main {
        border-radius: 22px;
        padding: 1.65rem;
        max-height: none;
        height: auto;
        width: 100%;
      }

      .description-container {
        padding: 1.4rem;
        gap: 0.85rem;
      }

      .description-tags {
        gap: 0.35rem;
      }

      .tab-container {
        margin-top: 0.9rem;
        justify-content: flex-start;
      }

      .tab-nav {
        width: 100%;
        justify-content: flex-start;
      }

      .tab-button {
        flex: 1 1 auto;
        text-align: center;
      }

      .plugins-grid {
        overflow: visible;
        padding-right: 0;
        margin-top: 1.1rem;
      }

      .plugin-card {
        flex-direction: column;
        align-items: stretch;
        gap: 0.9rem;
      }

      .plugin-actions {
        align-self: stretch;
        display: flex;
        width: 100%;
        justify-content: center;
        gap: 0.65rem;
        flex-wrap: wrap;
      }

      .plugin-actions .plugin-button {
        flex: 1 1 100%;
        justify-content: center;
        min-width: 0;
      }
    }

    @keyframes background-pan {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes glow-shift {
      0% {
        transform: rotate(0deg) scale(1);
      }

      50% {
        transform: rotate(6deg) scale(1.08);
      }

      100% {
        transform: rotate(0deg) scale(1);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 0.7;
      }

      50% {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <main>
    <div class="header-block">
      <div style="display: flex; justify-content: center;">
        <span class="badge">Lampa Plugins Catalog</span>
      </div>
      <div class="description-container">
        <p>Browse and install community-maintained plugins for Lampa media center. Each plugin extends Lampa's
          functionality with
          additional streaming sources, subtitle providers, and enhanced features.</p>
        <!-- <p>Deploy directly from Cloudflare Pages or copy a shareable link for your teams. Updates propagate instantly,
          so your environment always reflects the latest improvements contributed by the community.</p> -->
        <!-- <ul class="description-tags">
          <li>Streaming Sources</li>
          <li>Interface Tweaks</li>
          <li>Automation</li>
          <li>Security Tooling</li>
          <li>Custom Themes</li>
        </ul> -->
      </div>
      <div class="tab-container" hidden>
        <div class="tab-nav" role="tablist" aria-label="Plugin groups"></div>
      </div>
    </div>
    <section class="plugins-grid" data-state="loading">
      <div class="plugin-card" aria-live="polite">
        <div class="plugin-card-content">
          <strong>Loading catalog…</strong>
          <div class="plugin-meta">Fetching the latest plugin list</div>
        </div>
        <div class="plugin-actions">
          <span class="plugin-button secondary" aria-hidden="true">⌛</span>
        </div>
      </div>
    </section>
    <footer>
      Maintain your plugin bundle in the <a href="https://github.com/pavelpikta/lampa-plugins">project repository</a>.
    </footer>
  </main>
  <script>
    (function () {
      const grid = document.querySelector('.plugins-grid');
      if (!grid) return;

      const tabContainer = document.querySelector('.tab-container');
      const tabNav = document.querySelector('.tab-nav');

      const state = {
        groups: [],
        groupMap: new Map(),
        activeKey: null,
      };

      const fallbackDescription = 'Not provided';
      const fallbackVersion = '1.0.0';

      function formatLabelFromName(name) {
        return name
          .replace(/\.js$/i, '')
          .replace(/[_\-]+/g, ' ')
          .split(' ')
          .filter(Boolean)
          .map(function (segment) {
            return segment.charAt(0).toUpperCase() + segment.slice(1);
          })
          .join(' ');
      }

      function formatGroupLabel(value) {
        return value
          .replace(/[_\-]+/g, ' ')
          .split(' ')
          .filter(Boolean)
          .map(function (segment) {
            return segment.charAt(0).toUpperCase() + segment.slice(1);
          })
          .join(' ');
      }

      function extractFolderName(name) {
        if (typeof name !== 'string') return null;
        const parts = name.split('/');
        return parts.length > 1 ? parts[0] : null;
      }

      function sortPlugins(list) {
        return list
          .slice()
          .sort(function (a, b) {
            return a.name.localeCompare(b.name);
          });
      }

      function normalizePluginEntry(entry) {
        if (!entry || typeof entry.name !== 'string') {
          return null;
        }

        const name = entry.name.trim();
        if (!name) {
          return null;
        }

        const label = entry.label && entry.label.trim() ? entry.label : formatLabelFromName(name);
        const href = entry.href && entry.href.trim()
          ? entry.href
          : entry.url && entry.url.trim()
            ? entry.url
            : '/' + name;
        const description = entry.description && entry.description.trim()
          ? entry.description
          : fallbackDescription;
        const version = entry.version && entry.version.trim()
          ? entry.version
          : fallbackVersion;

        return {
          name,
          label,
          href,
          description,
          version
        };
      }

      function createPluginGroups(plugins) {
        const folders = new Map();
        const standalone = [];

        plugins.forEach(function (plugin) {
          const folder = extractFolderName(plugin.name);
          if (!folder) {
            standalone.push(plugin);
            return;
          }

          if (!folders.has(folder)) {
            folders.set(folder, []);
          }

          folders.get(folder).push(plugin);
        });

        const ordered = [];
        const groupMap = new Map();

        function registerGroup(key, label, items) {
          const group = {
            key,
            label,
            plugins: sortPlugins(items),
          };

          ordered.push(group);
          groupMap.set(key, group);
        }

        registerGroup('all', 'All Plugins', plugins);

        if (standalone.length) {
          registerGroup('standalone', 'Standalone', standalone);
        }

        Array.from(folders.keys())
          .sort(function (a, b) {
            return a.localeCompare(b);
          })
          .forEach(function (folder) {
            registerGroup(folder, formatGroupLabel(folder), folders.get(folder));
          });

        return { groups: ordered, map: groupMap };
      }

      function renderTabs(groups) {
        if (!tabContainer || !tabNav) {
          return;
        }

        tabNav.innerHTML = '';

        if (!groups || groups.length <= 1) {
          tabContainer.setAttribute('hidden', 'true');
          return;
        }

        tabContainer.removeAttribute('hidden');

        groups.forEach(function (group, index) {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'tab-button';
          button.dataset.tab = group.key;
          button.textContent = group.label;
          button.setAttribute('role', 'tab');

          if (index === 0) {
            button.classList.add('active');
            button.setAttribute('aria-selected', 'true');
          } else {
            button.setAttribute('aria-selected', 'false');
            button.tabIndex = -1;
          }

          button.addEventListener('click', function () {
            activateGroup(group.key);
          });

          tabNav.appendChild(button);
        });
      }

      function updateTabSelection(activeKey) {
        if (!tabNav) {
          return;
        }

        const buttons = tabNav.querySelectorAll('.tab-button');
        buttons.forEach(function (button) {
          const isActive = button.dataset.tab === activeKey;
          button.classList.toggle('active', isActive);
          button.setAttribute('aria-selected', isActive ? 'true' : 'false');
          if (isActive) {
            button.removeAttribute('tabindex');
          } else {
            button.setAttribute('tabindex', '-1');
          }
        });
      }

      function renderPluginList(list) {
        if (!Array.isArray(list) || list.length === 0) {
          grid.setAttribute('data-state', 'empty');
          grid.replaceChildren(
            createCard({
              name: 'No plugins found',
              description: 'Nothing is registered in this category yet.',
            })
          );
          grid.scrollTop = 0;
          return;
        }

        const fragment = document.createDocumentFragment();
        list.forEach(function (plugin) {
          fragment.appendChild(createCard(plugin));
        });

        grid.replaceChildren(fragment);
        grid.setAttribute('data-state', 'ready');
        grid.scrollTop = 0;
      }

      function activateGroup(key) {
        if (!state.groupMap.has(key)) {
          return;
        }

        state.activeKey = key;
        updateTabSelection(key);
        const group = state.groupMap.get(key);
        renderPluginList(group.plugins);
      }

      function createCard(entry) {
        const hasLink = Boolean(entry.href);
        const container = document.createElement('div');
        container.className = 'plugin-card';
        if (!hasLink) {
          container.setAttribute('aria-disabled', 'true');
        }

        const wrapper = document.createElement('div');
        wrapper.className = 'plugin-card-content';

        const title = document.createElement('strong');
        const displayName = entry.label || entry.name || 'Untitled plugin';
        title.textContent = displayName;

        const meta = document.createElement('div');
        meta.className = 'plugin-meta';
        const metaParts = [];
        if (entry.name) {
          metaParts.push(entry.name);
        }
        if (entry.description) {
          metaParts.push(entry.description);
        }
        if (entry.version) {
          metaParts.push('v' + entry.version);
        }
        meta.textContent = metaParts.join(' • ') || fallbackDescription;

        wrapper.appendChild(title);
        wrapper.appendChild(meta);

        const actions = document.createElement('div');
        actions.className = 'plugin-actions';

        if (hasLink) {
          const openButton = document.createElement('a');
          openButton.className = 'plugin-button primary';
          openButton.href = entry.href;
          openButton.innerHTML = '<span class="icon" aria-hidden="true">↗</span><span class="sr-only">Open plugin</span>';
          actions.appendChild(openButton);

          const copyButton = document.createElement('button');
          copyButton.type = 'button';
          copyButton.className = 'plugin-button secondary copy';
          const srLabel = 'Copy link to ' + displayName;
          copyButton.setAttribute('aria-label', srLabel);
          copyButton.setAttribute('data-feedback', 'Copied!');

          const iconSpan = document.createElement('span');
          iconSpan.className = 'copy-icon';
          iconSpan.setAttribute('aria-hidden', 'true');
          iconSpan.textContent = '⧉';

          const labelSpan = document.createElement('span');
          labelSpan.className = 'copy-label';
          labelSpan.textContent = 'Copy';

          const srText = document.createElement('span');
          srText.className = 'sr-only';
          srText.textContent = srLabel;

          copyButton.append(iconSpan, labelSpan, srText);
          copyButton.addEventListener('click', function (event) {
            event.preventDefault();
            event.stopPropagation();
            copyPluginLink(entry.href, copyButton);
          });
          actions.appendChild(copyButton);
        } else {
          const infoBadge = document.createElement('span');
          infoBadge.className = 'plugin-button secondary';
          infoBadge.textContent = 'Info';
          actions.appendChild(infoBadge);
        }

        container.appendChild(wrapper);
        container.appendChild(actions);

        return container;
      }

      const endpoints = [
        { url: '/api/static', label: 'static catalog api' },
        { url: '/api/dynamic', label: 'dynamic catalog api' }
      ];

      function fetchEndpoint(endpoint) {
        return fetch(endpoint.url, { headers: { 'Accept': 'application/json' } })
          .then(function (response) {
            if (!response.ok) {
              throw new Error('Failed to load plugin index (' + response.status + ')');
            }
            const contentType = response.headers.get('content-type') || '';
            if (!contentType.includes('application/json')) {
              throw new Error('Unexpected content type: ' + contentType);
            }
            return response.json();
          });
      }

      function mergePluginLists(sourceLists) {
        const merged = new Map();

        sourceLists.forEach(function (list) {
          if (!Array.isArray(list)) {
            return;
          }

          list.forEach(function (item) {
            const normalized = normalizePluginEntry(item);
            if (!normalized) {
              return;
            }

            const existing = merged.get(normalized.name);
            if (existing) {
              merged.set(normalized.name, Object.assign({}, existing, normalized));
            } else {
              merged.set(normalized.name, normalized);
            }
          });
        });

        return Array.from(merged.values()).sort(function (a, b) {
          return a.name.localeCompare(b.name);
        });
      }

      async function loadCatalog() {
        const results = await Promise.all(endpoints.map(function (endpoint) {
          return fetchEndpoint(endpoint).catch(function (error) {
            console.warn('Catalog fetch failed via ' + endpoint.label, error);
            return null;
          });
        }));

        const merged = mergePluginLists(results);
        const succeeded = results.some(function (value) {
          return Array.isArray(value);
        });

        if (!succeeded) {
          throw new Error('All catalog endpoints failed');
        }

        return merged;
      }

      loadCatalog()
        .then(function (plugins) {
          if (!Array.isArray(plugins) || plugins.length === 0) {
            state.groups = [];
            state.groupMap = new Map();
            state.activeKey = null;
            if (tabContainer) {
              tabContainer.setAttribute('hidden', 'true');
            }
            grid.setAttribute('data-state', 'empty');
            grid.innerHTML = '';
            grid.appendChild(createCard({
              name: 'No plugins found',
              description: 'The catalog appears to be empty.'
            }));
            return;
          }
          const { groups, map } = createPluginGroups(plugins);
          state.groups = groups;
          state.groupMap = map;
          state.activeKey = null;

          renderTabs(groups);

          const initialGroup = groups.length ? groups[0] : null;
          if (initialGroup) {
            activateGroup(initialGroup.key);
          } else {
            renderPluginList([]);
          }
        })
        .catch(function (error) {
          console.warn('Dynamic plugin catalog update failed', error);
          state.groups = [];
          state.groupMap = new Map();
          state.activeKey = null;
          if (tabContainer) {
            tabContainer.setAttribute('hidden', 'true');
          }
          grid.setAttribute('data-state', 'error');
          grid.innerHTML = '';
          grid.appendChild(createCard({
            name: 'Failed to load catalog',
            description: 'Please refresh or check the network connection.'
          }));
        });

      function copyPluginLink(url, button) {
        if (!navigator.clipboard || typeof navigator.clipboard.writeText !== 'function') {
          fallbackCopy(url, button);
          return;
        }

        navigator.clipboard.writeText(new URL(url, window.location.href).href)
          .then(function () {
            flashCopiedState(button);
          })
          .catch(function () {
            fallbackCopy(url, button);
          });
      }

      function fallbackCopy(url, button) {
        try {
          const tempInput = document.createElement('textarea');
          tempInput.value = new URL(url, window.location.href).href;
          tempInput.setAttribute('readonly', '');
          tempInput.style.position = 'fixed';
          tempInput.style.top = '0';
          tempInput.style.left = '-9999px';
          document.body.appendChild(tempInput);
          tempInput.focus({ preventScroll: true });
          tempInput.select();
          document.execCommand('copy');
          flashCopiedState(button);
          document.body.removeChild(tempInput);
        } catch (error) {
          console.warn('Copy to clipboard failed', error);
        }
      }

      function flashCopiedState(button) {
        const icon = button.querySelector('.copy-icon');
        const label = button.querySelector('.copy-label');
        const srOnly = button.querySelector('.sr-only');
        const originalIcon = icon ? icon.textContent : null;
        const originalLabel = label ? label.textContent : null;
        const originalSr = srOnly ? srOnly.textContent : null;
        const originalAriaLabel = button.getAttribute('aria-label');

        button.classList.add('copied');
        button.disabled = true;

        if (icon) {
          icon.textContent = '✔';
        }

        if (label) {
          label.textContent = 'Copied!';
        }

        if (srOnly) {
          srOnly.textContent = 'Link copied to clipboard';
        }

        button.setAttribute('aria-label', 'Link copied to clipboard');

        setTimeout(function () {
          if (icon && originalIcon !== null) {
            icon.textContent = originalIcon;
          }

          if (label && originalLabel !== null) {
            label.textContent = originalLabel;
          }

          if (srOnly && originalSr !== null) {
            srOnly.textContent = originalSr;
          }

          if (originalAriaLabel !== null) {
            button.setAttribute('aria-label', originalAriaLabel);
          }

          button.classList.remove('copied');
          button.disabled = false;
        }, 1600);
      }
    })();
  </script>
</body>

</html>
